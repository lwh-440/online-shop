{% extends "base.html" %}

{% block title %}商品列表 - 在线购物网站{% endblock %}

{% block content %}
<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin: 2rem 0;">
        <h1>商品列表</h1>
        
        <!-- 搜索和筛选 -->
        <form method="GET" action="{{ url_for('product_list') }}" style="display: flex; gap: 1rem; align-items: center;">
            <input type="text" name="search" class="form-control" placeholder="搜索商品..." value="{{ search }}" style="width: 200px;">
            <select name="category_id" class="form-control" style="width: 150px;">
                <option value="">所有分类</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if category_id == cat.id %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">搜索</button>
        </form>
    </div>
    
    {% if products %}
        <div class="products-grid">
            {% for product in products %}
                <div class="product-card">
                    <img src="{{ url_for('static', filename=product.image_url) }}" alt="{{ product.name }}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-name">{{ product.name }}</h3>
                        <p class="product-description" style="color: #666; margin-bottom: 0.5rem; font-size: 0.9rem;">
                            {{ product.description[:80] }}{% if product.description|length > 80 %}...{% endif %}
                        </p>
                        <div class="product-price">¥{{ "%.2f"|format(product.price) }}</div>
                        
                        <div class="product-category" style="color: #888; font-size: 0.85rem; margin-bottom: 0.5rem;">
                            分类: {{ product.category_id or '未分类' }}
                        </div>
                        
                        <div class="product-stock">库存: {{ product.stock }}</div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn btn-primary" style="flex: 1;">查看详情</a>
                            {% if product.stock > 0 %}
                                <form method="POST" action="{{ url_for('add_to_cart') }}" style="flex: 1;">
                                    <input type="hidden" name="product_id" value="{{ product.id }}">
                                    <input type="hidden" name="quantity" value="1">
                                    <button type="submit" class="btn btn-success" style="width: 100%;">加入购物车</button>
                                </form>
                            {% else %}
                                <button class="btn btn-secondary" style="flex: 1;" disabled>缺货</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem;">
            <p style="font-size: 1.2rem; color: #666;">没有找到相关商品</p>
            <a href="{{ url_for('product_list') }}" class="btn btn-primary" style="margin-top: 1rem;">查看所有商品</a>
        </div>
    {% endif %}
</div>
{% endblock %}
